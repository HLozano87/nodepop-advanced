<%- include('header') %>

<div class="container mt-4">
  <% if (!session.userId) { %>

    <div class="alert alert-info" role="alert">
      <%= __("To view your products, you must") %>
      <a href="/login" class="alert-link">login</a>.
    </div>
  <% } else { %>

    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2><%= __("My Products") %></h2>
      <a href="/user/new" class="btn btn-primary"><%= __("Add new product") %></a>
    </div>

    <% if (products.length === 0) { %>

      <div class="alert alert-warning" role="alert">
        <%= __("You have no products, add your first product!") %>
      </div>
    <% } else { %>

      <div class="row row-cols-1 row-cols-md-3 g-4">
        <% for (const product of products) { %>
          <div class="col">
            <div class="card h-100" id="<%= product._id %>">
              <img
                src="<%= product.image ? `/uploads/${product.image}` : 'https://placehold.co/600x400.png'%>"
                class="card-img-top"
                alt="<%= product.name %>"
              />
              <div class="card-body">
                <h5 class="card-title"><%= product.name %></h5>

                <% if (product.tags && product.tags.length > 0) { %>
                  <p class="card-text">
                    <% for (const tag of product.tags) { %>
                      <span class="badge bg-secondary me-1"><%= tag %></span>
                    <% } %>
                  </p>
                <% } %>

                <p class="card-text fw-bold text-primary">
                  <%= product.price.toFixed(2) %>€
                </p>
              </div>

              <div class="card-footer bg-white d-flex justify-content-between">
                <form
                  action="/user/delete/<%= product._id %>"
                  method="post"
                  class="d-inline"
                >
                  <button
                    type="submit"
                    class="btn btn-sm btn-outline-danger"
                    onclick="return confirm('<%= __(`¿Are you sure you want to remove?`) %>')"
                  >
                    <i class="bi bi-trash"></i> <%= __("Delete") %>
                  </button>
                </form>
              </div>
            </div>
          </div>
        <% } %>
      </div>
    <% } %>
  <% } %>
</div>

<%- include('footer') %>
